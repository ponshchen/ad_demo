<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>content-gallery h5 template</title>
    <style>
      * {
        margin: 0;
      }

      body {
        background-color: transparent;
      }

      .banner {
        position: fixed;
        width: 100vw;
        bottom: 0;
        top: 0;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #videoContainer {
        width: 100vw;
        height: 213vw;
        max-height: 100vh;
        position: relative;
      }

      #video1 {
        z-index: 1;
      }

      #video2 {
        display: none;
        z-index: 2;
      }

      #video3 {
        display: none;
        z-index: 3;
      }

      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }

      #close {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 36px;
        height: 36px;
        z-index: 5;
      }

      #circle {
        position: absolute;
        left: 32vw;
        top: 125vw;
        width: 36vw;
        height: 36vw;
        border-radius: 50%;
        z-index: 100;
        display: none;
      }

      #spoon {
        width: 68vw;
        height: 68vw;
        position: absolute;
        left: calc(57vw - 34vw);
        top: calc(155vw - 34vw);
        z-index: 100;
        display: none;
      }
    </style>
  </head>
  <body>
    <img src="./images/background0.png" style="width: 100vw" />
    <img src="./images/background1.png" style="width: 100vw" />
    <div class="banner" id="banner">
      <img src="./images/close.png" alt="" id="close" onclick="closeAd()" />
      <div id="videoContainer">
        <video autoplay muted playsinline id="video1">
          <source src="./images/535/1.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <video muted playsinline preload id="video2">
          <source src="./images/535/2.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <div id="circle"></div>
        <img src="./images/535/spoon.png" alt="" id="spoon" />
      </div>
    </div>
    <img src="./images/background2.png" style="width: 100vw" />
  </body>
  <script>
    const banner = document.getElementById("banner");
    const video1 = document.getElementById("video1");
    const video2 = document.getElementById("video2");
    const spoon = document.getElementById("spoon");
    const circle = document.getElementById("circle");
    const videoContainer = document.getElementById("videoContainer");
    const RADIUS = window.screen.width * 0.18;
    const timer = 5; // 進入第二 cut 之後多久自動切換到第三 cut

    video1.addEventListener("ended", (event) => {
      video2.style.display = "block";
      circle.style.display = "block";
      spoon.style.display = "block";

      function bannerTouchmove(e) {
        const touch = e.touches[0];
        const x = touch.clientX;
        const y = touch.clientY;
        moveSpoon(x, y);
      }

      function bannerTouchstart() {
        video2.play();
      }

      function bannerTouchend() {
        video2.pause();
      }

      function unlockAudio() {
        video2.muted = false;

        video2.play().catch((err) => {
          video2.muted = true;
        });
      }

      banner.addEventListener("touchmove", bannerTouchmove, { passive: false });
      banner.addEventListener("touchstart", bannerTouchstart);
      banner.addEventListener("touchend", bannerTouchend);
      banner.addEventListener("pointerdown", unlockAudio, { once: true });

      setTimeout(() => {
        video2.currentTime = timer;
        video2.play();
        spoon.remove();
        circle.remove();
        video2.onclick = openAd;
        banner.removeEventListener("touchmove", bannerTouchmove);
        banner.removeEventListener("touchstart", bannerTouchstart);
        banner.removeEventListener("touchend", bannerTouchend);
      }, timer * 1000);
    });

    function openAd() {
      window.open("https://www.google.com");
    }

    function closeAd() {
      banner.remove();
    }

    function getCenter() {
      const circleRects = circle.getClientRects()[0];
      const circleWidth = circleRects.width;
      return {
        x: circleRects.left + circleWidth / 2,
        y: circleRects.top + circleWidth / 2,
      };
    }

    function moveSpoon(x, y) {
      const center = getCenter();
      const dx = x - center.x;
      const dy = y - center.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      let finalX = x;
      let finalY = y;

      if (distance > RADIUS) {
        const ratio = RADIUS / distance;
        finalX = center.x + dx * ratio;
        finalY = center.y + dy * ratio;
      }

      const spoonWidth = spoon.getClientRects()[0].width;
      spoon.style.left = finalX - spoonWidth / 2 + "px";
      spoon.style.top =
        finalY - videoContainer.getClientRects()[0].top - spoonWidth / 2 + "px";
    }
  </script>
</html>
