<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>content-gallery h5 template</title>
    <style>
      * {
        margin: 0;
      }

      body {
        background-color: transparent;
      }

      .banner {
        position: fixed;
        width: 100vw;
        bottom: 0;
        top: 0;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .videoContainer {
        width: 100vw;
        height: 213vw;
        max-height: 100vh;
        position: relative;
      }

      #video2 {
        display: none;
        z-index: 2;
      }

      #video3 {
        display: none;
        z-index: 3;
      }

      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }

      #close {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 36px;
        height: 36px;
        z-index: 5;
      }

      #circle {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 50vw;
        height: 50vw;
        margin-left: -25vw;
        margin-top: -25vw;
        border: 2px dashed #999;
        border-radius: 50%;
        z-index: 100;
        display: none;
      }

      #spoon {
        width: 60px;
        height: 60px;
        background: hotpink;
        position: fixed; /* 或 absolute */
        left: calc(50% - 30px);
        top: calc(50% - 30px);
        border-radius: 12px;
        pointer-events: none; /* 不擋觸控 */
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <img src="./images/background0.png" style="width: 100vw" />
    <img src="./images/background1.png" style="width: 100vw" />
    <div class="banner" id="banner">
      <img src="./images/close.png" alt="" id="close" onclick="closeAd()" />
      <div class="videoContainer">
        <video autoplay muted playsinline id="video1">
          <source src="./images/535/1.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <video muted playsinline preload loop id="video2">
          <source src="./images/535/2.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <video muted playsinline preload id="video3">
          <source src="./images/535/3.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <div id="circle">
          <div id="spoon"></div>
        </div>
      </div>
    </div>
    <img src="./images/background2.png" style="width: 100vw" />
  </body>
  <script>
    const banner = document.getElementById("banner");
    const video1 = document.getElementById("video1");
    const video2 = document.getElementById("video2");
    const video3 = document.getElementById("video3");
    const spoon = document.getElementById("spoon");
    const circle = document.getElementById("circle");
    const RADIUS = window.screen.width / 4;
    const timer = 5; // 進入第二 cut 之後多久自動切換到第三 cut

    video1.addEventListener("ended", (event) => {
      video2.style.display = "block";
      circle.style.display = "block";
      banner.addEventListener("touchmove", function (e) {
        // 取得第一根手指
        const touch = e.touches[0];

        const x = touch.clientX;
        const y = touch.clientY;

        moveSpoon(x, y);
      });
      banner.addEventListener("touchstart", () => video2.play());
      banner.addEventListener("touchend", () => video2.pause());
      setTimeout(() => {
        video3.play();
        video3.style.display = "block";
        setTimeout(() => {
          video3.onclick = openAd;
          video1.remove();
          video2.remove();
          spoon.remove();
          circle.remove();
        }, 100);
      }, timer * 1000);
    });

    function switchToThirdCut() {
      video2.remove();
      video1.remove();
      video3.play();
      video3.style.display = "block";
      setTimeout(() => {
        video3.onclick = openAd;
      }, 100);
    }

    function openAd() {
      window.open("https://www.google.com");
    }

    function closeAd() {
      banner.remove();
    }

    function getCenter() {
      return {
        x: window.innerWidth / 2,
        y: window.innerHeight / 2,
      };
    }

    function moveSpoon(x, y) {
      const center = getCenter();
      const dx = x - center.x;
      const dy = y - center.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      let finalX = x;
      let finalY = y;

      // 超出圓形 → 拉回圓周
      if (distance > RADIUS) {
        const ratio = RADIUS / distance;
        finalX = center.x + dx * ratio;
        finalY = center.y + dy * ratio;
      }

      spoon.style.left = finalX - spoon.clientWidth / 2 + "px";
      spoon.style.top = finalY - spoon.clientWidth / 2 + "px";
    }
  </script>
</html>
